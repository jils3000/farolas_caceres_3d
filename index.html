<!DOCTYPE html>
<html>
<head>
  <title>Edificios y Farolas Cáceres 3D</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />
  <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
  <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>

  <style>
    html, body,#map {
      width:100%; 
      height:100%; 
      padding: 0; 
      margin: 0;
    }
  </style>
</head>

<body>
  
  <!--Map-->
  <div id='map'></div>

  <!--Legend-->
  <div class='cartodb-legend category'> 
    <div class="legend-title">TIPO DE LÁMPARA</div>
    <ul>
      <li>
        <div class="bullet" style="background: #A6CEE3"></div> Fluorescente (F)
      </li>
      <li>
        <div class="bullet" style="background: #1F78B4"></div> FCBC
      </li>
      <li>
       <div class="bullet" style="background: #B2DF8A"></div> Halógena (H)
      </li>
      <li>
        <div class="bullet" style="background: #33A02C"></div> Halogenuros metálicos (HM)
      </li>
      <li>
        <div class="bullet" style="background: #FB9A99"></div> Incandescencia (I)
      </li>
      <li>
        <div class="bullet" style="background: #E31A1C"></div> MC
      </li>
      <li>
        <div class="bullet" style="background: #FDBF6F"></div> PAR
      </li>
      <li>
        <div class="bullet" style="background: #FF7F00"></div> Vapor Mercurio Color Corregido (VMCC)
      </li>
      <li>
        <div class="bullet" style="background: #CAB2D6"></div> Vapor Sodio Alta Presión (VSAP)
      </li>
      <li>
        <div class="bullet" style="background: #6A3D9A"></div> Vapor Sodio Baja Presión (VSBP)
      </li>
      <li>
        <div class="bullet" style="background: #DDDDDD"></div> LED
      </li>
    </ul>
  </div>
  
  <script type="text/javascript">
    function main() {

      //Edificios
      var style = [
        '#edificios_caceres{',
        ' polygon-opacity: 0.0;',
        '  line-opacity:0;',
        '  line-color: #FFFFFF;',
        '  [alturas>0]{',
        '    polygon-fill:#FF6E40;',
        '    polygon-opacity: 0.7;',
        '    line-opacity:0.3;',
        '    line-color: #FFFFFF;',
        '    [zoom = 12] {polygon-opacity:.2;}',
        '    [zoom = 13] {polygon-opacity:.4;}',
        '    [zoom = 15] {polygon-opacity:.5;}',
        '    [zoom >16]::under{',
        '      building-fill-opacity: 0;',
        '    }',
        '    [zoom >16]{',
        '      polygon-fill:transparent;',
        '      line-color: rgba(0,0,0,0.3);',
        '      building-fill:#FF6E40;',
        '      building-fill-opacity: 1;',
        '      building-height: [alturas]*0.8;',
        '    }',
        '  }',
        '}'
      ].join('\n');

      
      //Farolas
      var style3 = [
        '#farolas_circulos{',
        ' polygon-opacity: 0.0;',
        '  line-opacity:0;',
        '  line-color: #FFFFFF;',
        '  [om_altura>0]{',
        '    [om_tipolam="F"] {polygon-fill: #A6CEE3;}',
        '    [om_tipolam="FCBC"] {polygon-fill: #1F78B4;}',
        '    [om_tipolam="H"] {polygon-fill: #B2DF8A;}',
        '    [om_tipolam="HM"] {polygon-fill: #33A02C;}',
        '    [om_tipolam="I"] {polygon-fill: #FB9A99;}',
        '    [om_tipolam="MC"] {polygon-fill: #E31A1C;}',
        '    [om_tipolam="PAR"] {polygon-fill: #FDBF6F;}',
        '    [om_tipolam="VMCC"] {polygon-fill: #FF7F00;}',
        '    [om_tipolam="VSAP"] {polygon-fill: #CAB2D6;}',
        '    [om_tipolam="VSBP"] {polygon-fill: #6A3D9A;}',
        '    polygon-opacity: 0.7;',
        '    line-opacity:0.3;',
        '    line-color: #FFFFFF;',
        '    [zoom = 12] {polygon-opacity:.2;}',
        '    [zoom = 13] {polygon-opacity:.4;}',
        '    [zoom = 15] {polygon-opacity:.5;}',
        '    [zoom >16]::under{',
        '      building-fill-opacity: 0;',
        '    }',
        '    [zoom >16]{',
        '      line-color: rgba(0,0,0,0.3);',
        '      [om_tipolam="F"] {building-fill: #A6CEE3;}',
        '      [om_tipolam="FCBC"] {building-fill: #1F78B4;}',
        '      [om_tipolam="H"] {building-fill: #B2DF8A;}',
        '      [om_tipolam="HM"] {building-fill: #33A02C;}',
        '      [om_tipolam="I"] {building-fill: #FB9A99;}',
        '      [om_tipolam="MC"] {building-fill: #E31A1C;}',
        '      [om_tipolam="PAR"] {building-fill: #FDBF6F;}',
        '      [om_tipolam="VMCC"] {building-fill: #FF7F00;}',
        '      [om_tipolam="VSAP"] {building-fill: #CAB2D6;}',
        '      [om_tipolam="VSBP"] {building-fill: #6A3D9A;}',
        '      building-fill-opacity: 1;',
        '      building-height: [om_altura];',
        '    }',
        '  }',
        '}'
      ].join('\n');

      var map = new L.Map('map', {
            zoomControl: true,
            center: [39.475193, -6.371393],
            zoom: 18

          });
        
          cartodb.createLayer(map, {
            user_name: 'oddfarolas',
            type: 'cartodb',
            sublayers: [
              {
                type: "http", // add basemap without labels
                urlTemplate: "http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",
                subdomains: [ "a", "b", "c" ]
              },
              {
                 type: "mapnik", // buildings
                 sql: 'SELECT * FROM edificios_caceres ORDER BY ST_YMax(the_geom) DESC',
                 cartocss: style
              },
              {
                 type: "mapnik", // luminarias
                 sql: 'SELECT * FROM farolas_circulos ORDER BY ST_YMax(the_geom) DESC',
                 cartocss: style3
              },
              //{
              //  type: "http", // add basemap labels
              //  urlTemplate: "http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",
              //  subdomains: [ "a", "b", "c" ]
              //},
            ]
          })
        .addTo(map);
      }
      window.onload = main;
  </script>
</body>
</html>